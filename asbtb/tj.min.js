var demo=new Vue({el:"#main",data:{searchString:"",searchtext:"正在加载...",answer:"等待输入",coupons:[[]],foundCoupons:[],page:0,pagesize:20},watch:{searchString:function(b,a){this.answer="等待输入...";this.debouncedGetAnswer()}},created:function(){this.debouncedGetAnswer=_.debounce(this.search,1000)},methods:{search:function(){searchString=this.searchString;if(!searchString||searchString.trim()==""){this.foundCoupons=this.coupons.slice(0,this.pagesize);return}this.answer="正在查找...";var d=searchString.trim().split(" ");this.foundCoupons=[];for(var a=0;a<this.coupons.length;a++){c=this.coupons[a];var e=true;for(var b=0;b<d.length;b++){if(d[b]==""){continue}if(c[2].toLowerCase().indexOf(d[b])==-1){e=false;break}}if(e){this.foundCoupons.push(c);count++}}for(var a=0;a<this.coupons.length;a++){c=this.coupons[a];var e=true;for(var b=0;b<d.length;b++){if(d[b]==""){continue}if(c[2].toLowerCase().indexOf(d[b])==-1){e=false;break}}if(e){continue}for(var b=0;b<d.length;b++){if(d[b]==""){continue}if(c[2].toLowerCase().indexOf(d[b])!==-1){this.foundCoupons.push(c)}}}if(this.foundCoupons.length>0){this.answer="找到了 "+this.foundCoupons.length.toString()+" 件商品"}else{this.answer="没有找到您需要的商品！"}return},handleScroll:function(){var e=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;var d=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var b=document.querySelector("#listview0").offsetHeight-d-20;if(e>b){this.page=this.page+1;if(this.page*this.pagesize>this.coupons.length){this.page=0;this.foundCoupons=[]}for(var a=0;a<this.pagesize;a++){this.foundCoupons.push(this.coupons[this.page*this.pagesize+a])}}},getdata:function(a){this.$http.get("https://repletetop.github.io/asbtb/TH."+a.toString()+".js").then(function(b){this.coupons=this.coupons.concat(b.body);if(a<9){this.getdata(a+1)}},function(){console.log("请求失败处理")})}},mounted:function(){window.addEventListener("scroll",this.handleScroll);this.$http.get("https://repletetop.github.io/asbtb/TH.js").then(function(b){this.coupons=b.body;this.foundCoupons=[];for(var a=0;a<this.pagesize;a++){this.foundCoupons.push(this.coupons[a])}this.searchtext="搜索";this.getdata(0)},function(){console.log("请求失败处理")})},destroyed:function(){window.removeEventListener("scroll",this.handleScroll)},computed:{filteredCoupons:function(){var d=this.foundCoupons,a=this.searchString;if(!a||a.trim()==""){return d}var b=a.trim().split(" ");a=a.trim().toLowerCase();d=d.filter(function(f){for(var e in b){if(b[e]==""){continue}if(f[2].toLowerCase().indexOf(b[e])!==-1){return f}}});return d}}});